(function(){document.addEventListener("DOMContentLoaded",function(){w("GameCanvas")},false);var v=3.141592653589793;var g=2*v;var u=v/2;var o=this.WebGL2D=function o(y){this.canvas=y;this.gl=undefined;this.fs=undefined;this.vs=undefined;this.shaderProgram=undefined;this.transform=new r();this.shaderPool=[];this.maxTextureSize=undefined;this.width;this.height;y.gl2d=this;var A=this.gl=y.getContext("webgl",{alpha:false})||y.getContext("experimental-webgl",{alpha:false});if((typeof(A)==="undefined")||(A===null)){return}try{this.initShaders();this.initBuffers()}catch(z){throw z}y.getContext=(function(B){return function(C){return new l(B)}}(this))};var h={texture:1,crop:2,path:4};o.prototype.getFragmentShaderSource=function d(z){var y=["#ifdef GL_ES","precision highp float;","#endif","#define hasTexture "+((z&h.texture)?"1":"0"),"#define hasCrop "+((z&h.crop)?"1":"0"),"varying vec4 vColor;","#if hasTexture","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","#if hasCrop","uniform vec4 uCropSource;","#endif","#endif","void main(void) {","#if hasTexture","#if hasCrop","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x * uCropSource.z, vTextureCoord.y * uCropSource.w) + uCropSource.xy) * vColor;","#else","gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","#endif","#else","gl_FragColor = vColor;","#endif","}"].join("\n");return y};o.prototype.getVertexShaderSource=function f(A,C){var z=2/this.canvas.width,B=-2/this.canvas.height;A=A||1;var y=["#define hasTexture "+((C&h.texture)?"1":"0"),"attribute vec4 aVertexPosition;","#if hasTexture","varying vec2 vTextureCoord;","#endif","uniform vec4 uColor;","uniform mat3 uTransforms["+A+"];","varying vec4 vColor;","const mat4 pMatrix = mat4("+z+",0,0,0, 0,"+B+",0,0, 0,0,1.0,1.0, -1.0,1.0,0,0);","mat3 crunchStack(void) {","mat3 result = uTransforms[0];","for (int i = 1; i < "+A+"; ++i) {","result = uTransforms[i] * result;","}","return result;","}","void main(void) {","vec3 position = crunchStack() * vec3(aVertexPosition.x, aVertexPosition.y, 1.0);","gl_Position = pMatrix * vec4(position, 1.0);","vColor = uColor;","#if hasTexture","vTextureCoord = aVertexPosition.zw;","#endif","}"].join("\n");return y};o.prototype.initShaders=function x(C,B){var D=this.gl;C=C||1;B=B||0;var z=this.shaderPool[C];if(!z){z=this.shaderPool[C]=[]}z=z[B];if(z){D.useProgram(z);this.shaderProgram=z;return z}else{var y=this.fs=D.createShader(D.FRAGMENT_SHADER);D.shaderSource(this.fs,this.getFragmentShaderSource(B));D.compileShader(this.fs);if(!D.getShaderParameter(this.fs,D.COMPILE_STATUS)){throw"fragment shader error: "+D.getShaderInfoLog(this.fs)}var F=this.vs=D.createShader(D.VERTEX_SHADER);D.shaderSource(this.vs,this.getVertexShaderSource(C,B));D.compileShader(this.vs);if(!D.getShaderParameter(this.vs,D.COMPILE_STATUS)){throw"vertex shader error: "+D.getShaderInfoLog(this.vs)}var E=this.shaderProgram=D.createProgram();E.stackDepth=C;D.attachShader(E,y);D.attachShader(E,F);D.linkProgram(E);if(!D.getProgramParameter(E,D.LINK_STATUS)){throw"Could not initialise shaders."}D.useProgram(E);E.vertexPositionAttribute=D.getAttribLocation(E,"aVertexPosition");D.enableVertexAttribArray(E.vertexPositionAttribute);E.uColor=D.getUniformLocation(E,"uColor");E.uSampler=D.getUniformLocation(E,"uSampler");E.uCropSource=D.getUniformLocation(E,"uCropSource");E.uTransforms=[];for(var A=0;A<C;++A){E.uTransforms[A]=D.getUniformLocation(E,"uTransforms["+A+"]")}this.shaderPool[C][B]=E;return E}};var m;var p;var e;var t;var n=new Float32Array([0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,0]);o.prototype.initBuffers=function s(){var y=this.gl;m=y.createBuffer();p=y.createBuffer();e=y.createBuffer();t=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,m);y.bufferData(y.ARRAY_BUFFER,n,y.STATIC_DRAW)};var l=this.WebGL2DAPI=function l(ac){var V=ac.gl;var H=1,N=1,y=1;var D=1,U="source-over";ac.width=ac.canvas.width;ac.height=ac.canvas.height;V.viewport(0,0,ac.width,ac.height);V.clearColor(0,0,0,1);V.clear(V.COLOR_BUFFER_BIT);V.enable(V.BLEND);V.blendFunc(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA);ac.maxTextureSize=V.getParameter(V.MAX_TEXTURE_SIZE);gxtkGraphics.prototype.DrawSurface=function(ag,af,ah){if(!ag.image.complete){return}this.gc.drawImage(ag.image,af,ah)};gxtkGraphics.prototype.DrawSurface2=function(ag,af,al,ai,ah,aj,ak){if(!ag.image.complete){return}if(aj<0){ai+=aj;aj=-aj}if(ak<0){ah+=ak;ak=-ak}if(aj<=0||ak<=0){return}this.gc.drawImage(ag.image,ai,ah,aj,ak,af,al,aj,ak)};gxtkGraphics.prototype.SetScissor=function(af,ai,ag,ah){if(af!==0||ai!==0||ag!==this.Width()||ah!==this.Height()){V.enable(V.SCISSOR_TEST);ai=this.Height()-ai-ah;V.scissor(af,ai,ag,ah)}else{V.disable(V.SCISSOR_TEST)}};gxtkGraphics.prototype.BeginRender=function(){if(this.gc){if(ac.width!==this.Width()||ac.height!==this.Height()){ac.shaderPool=[];ac.initShaders();ac.width=this.Width();ac.height=this.Height();V.viewport(0,0,ac.width,ac.height)}this.gc.save()}};Object.defineProperty(this,"fillStyle",{get:function(){return""},set:function(ag){var af=ag.slice(4,-1).split(",");H=af[0]>=255?1:af[0]/255;N=af[1]>=255?1:af[1]/255;y=af[2]>=255?1:af[2]/255}});Object.defineProperty(this,"strokeStyle",{get:function(){return""},set:function(af){}});Object.defineProperty(this,"globalAlpha",{get:function(){return D},set:function(af){D=af}});Object.defineProperty(this,"globalCompositeOperation",{get:function(){return U},set:function(af){if(U===af){return}if(af==="lighter"){V.blendFunc(V.SRC_ALPHA,V.ONE)}else{V.blendFunc(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA)}U=af}});this.save=function Y(){ac.transform.pushMatrix()};this.restore=function X(){ac.transform.popMatrix()};this.translate=function O(af,ag){ac.transform.translate(af,ag)};var W=function W(af){ac.transform.rotate(af)};this.scale=function ad(af,ag){ac.transform.scale(af,ag)};this.transform=function P(aj,ai,al,ak,ah,ag){var af=ac.transform.m_stack[ac.transform.c_stack];af[0]=aj;af[1]=ai;af[3]=al;af[4]=ak;af[6]=ah;af[7]=ag};function M(ai){var af=ac.transform.m_stack;for(var ah=0,ag=ac.transform.c_stack+1;ah<ag;++ah){V.uniformMatrix3fv(ai.uTransforms[ah],false,af[ag-1-ah])}}this.setTransform=function C(ai,ah,ak,aj,ag,af){ac.transform.setIdentity();this.transform.apply(this,arguments)};this.fillRect=function L(ag,ak,ai,af){var ah=ac.transform;var aj=ac.initShaders(ah.c_stack+2,0);V.bindBuffer(V.ARRAY_BUFFER,m);V.vertexAttribPointer(aj.vertexPositionAttribute,4,V.FLOAT,false,0,0);ah.pushMatrix();ah.translate(ag,ak);ah.scale(ai,af);M(aj);V.uniform4f(aj.uColor,H,N,y,D);V.drawArrays(V.TRIANGLE_FAN,0,4);ah.popMatrix()};var E=[];function K(af,ag){this.closed=false;this.verts=[af,ag,0,0]}var ae=this.beginPath=function ae(){E.length=0};var B=this.closePath=function B(){if(E.length){var ah=E[E.length-1],ag=ah.verts[0],af=ah.verts[1];ah.closed=true;var ai=new K(ag,af);E.push(ai)}};var R=this.moveTo=function R(af,ag){E.push(new K(af,ag))};var Q=this.lineTo=function Q(af,ag){if(E.length){E[E.length-1].verts.push(af,ag,0,0)}else{R(af,ag)}};this.rect=function z(af,ai,ag,ah){R(af,ai);Q(af+ag,ai);Q(af+ag,ai+ah);Q(af,ai+ah);B()};this.arc=function J(am,al,aj,ak,ag,ah){if(!E.length){R(am,al+aj);var af=u*0.1;var an=E[0].verts;for(var ai=af;ai<g;ai+=af){an.push(am+Math.sin(ai)*aj,al+Math.cos(ai)*aj,0,0)}}else{var af=u*0.1;var an=E[E.length-1].verts;for(var ai=0;ai<360;ai+=af){an.push(am+Math.sin(ai)*aj,al+Math.cos(ai)*aj,0,0)}}};function Z(ah){var ag=ac.transform;var aj=ac.initShaders(ag.c_stack+2,0);var af=E[ah];var ai=af.verts;V.bindBuffer(V.ARRAY_BUFFER,e);V.bufferData(V.ARRAY_BUFFER,new Float32Array(ai),V.STATIC_DRAW);V.vertexAttribPointer(aj.vertexPositionAttribute,4,V.FLOAT,false,0,0);ag.pushMatrix();M(aj);V.uniform4f(aj.uColor,H,N,y,D);V.drawArrays(V.TRIANGLE_FAN,0,ai.length/4);ag.popMatrix()}this.fill=function T(){for(var af=0;af<E.length;af++){Z(af)}};function F(ah){var ag=ac.transform;var aj=ac.initShaders(ag.c_stack+2,0);var af=E[ah];var ai=af.verts;V.bindBuffer(V.ARRAY_BUFFER,e);V.bufferData(V.ARRAY_BUFFER,new Float32Array(ai),V.STATIC_DRAW);V.vertexAttribPointer(aj.vertexPositionAttribute,4,V.FLOAT,false,0,0);ag.pushMatrix();M(aj);V.uniform4f(aj.uColor,H,N,y,D);if(af.closed){V.drawArrays(V.LINE_LOOP,0,ai.length/4)}else{V.drawArrays(V.LINE_STRIP,0,ai.length/4)}ag.popMatrix()}this.stroke=function I(){for(var af=0;af<E.length;af++){F(af)}};this.clip=function aa(){};var G=[],ab=[];function A(ah){this.obj=V.createTexture();this.index=ab.push(this);var ai=(typeof(CFG_MOJO_IMAGE_FILTERING_ENABLED)==="undefined"||CFG_MOJO_IMAGE_FILTERING_ENABLED==="true");G.push(ah);if(ah.width>ac.maxTextureSize||ah.height>ac.maxTextureSize){var ag=document.createElement("canvas");ag.width=(ah.width>ac.maxTextureSize)?ac.maxTextureSize:ah.width;ag.height=(ah.height>ac.maxTextureSize)?ac.maxTextureSize:ah.height;var af=ag.getContext("2d");af.drawImage(ah,0,0,ah.width,ah.height,0,0,ag.width,ag.height);ah=ag}V.bindTexture(V.TEXTURE_2D,this.obj);V.texImage2D(V.TEXTURE_2D,0,V.RGBA,V.RGBA,V.UNSIGNED_BYTE,ah);V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE);V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE);if(ai){V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR)}else{V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.NEAREST)}if(j(ah.width)&&j(ah.height)){if(ai){V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR_MIPMAP_LINEAR);V.generateMipmap(V.TEXTURE_2D)}else{V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.NEAREST_MIPMAP_NEAREST);V.generateMipmap(V.TEXTURE_2D)}}else{if(ai){V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR)}else{V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.NEAREST)}}V.bindTexture(V.TEXTURE_2D,null)}this.drawImage=function S(ah,at,ar,ap,ao,am,al,ak,aj){var ag=ac.transform;ag.pushMatrix();var ai=h.texture;var au=false;if(arguments.length===3){ag.translate(at,ar);ag.scale(ah.width,ah.height)}else{if(arguments.length===5){ag.translate(at,ar);ag.scale(ap,ao)}else{if(arguments.length===9){ag.translate(am,al);ag.scale(ak,aj);ai=ai|h.crop;au=true}}}var af=ac.initShaders(ag.c_stack,ai);var an,aq=G.indexOf(ah);if(aq!==-1){an=ab[aq]}else{an=new A(ah)}if(au){V.uniform4f(af.uCropSource,at/ah.width,ar/ah.height,ap/ah.width,ao/ah.height)}V.bindBuffer(V.ARRAY_BUFFER,m);V.vertexAttribPointer(af.vertexPositionAttribute,4,V.FLOAT,false,0,0);V.bindTexture(V.TEXTURE_2D,an.obj);V.activeTexture(V.TEXTURE0);V.uniform1i(af.uSampler,0);M(af);V.uniform4f(af.uColor,H,N,y,D);V.drawArrays(V.TRIANGLE_FAN,0,4);ag.popMatrix()}};function j(y){return y>0&&((y-1)&y)===0}var b={length:function(y){return Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])},normalize:function(y){var z=Math.sqrt((y[0]*y[0])+(y[1]*y[1])+(y[2]*y[2]));if(z===0){return[0,0,0]}return[y[0]/z,y[1]/z,y[2]/z]},dot:function(z,y){return z[0]*y[0]+z[1]*y[1]+z[2]*y[2]},angle:function(z,y){return Math.acos((z[0]*y[0]+z[1]*y[1]+z[2]*y[2])/(Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])*Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])))},cross:function(z,y){return[z[1]*y[2]-y[1]*z[2],z[2]*y[0]-y[2]*z[0],z[0]*y[1]-y[0]*z[1]]},multiply:function(z,y){return[z[0]*y,z[1]*y,z[2]*y]},add:function(z,y){return[z[0]+y[0],z[1]+y[1],z[2]+y[2]]},subtract:function(z,y){return[z[0]-y[0],z[1]-y[1],z[2]-y[2]]},equal:function(z,y){var A=1e-7;if((z===undefined)&&(y===undefined)){return true}if((z===undefined)||(y===undefined)){return false}return(Math.abs(z[0]-y[0])<A&&Math.abs(z[1]-y[1])<A&&Math.abs(z[2]-y[2])<A)}};var k={identity:[1,0,0,0,1,0,0,0,1],multiply:function(z,y){var R=z[0],Q=z[1],P=z[2],O=z[3],N=z[4],M=z[5],L=z[6],K=z[7],J=z[8],I=y[0],H=y[1],G=y[2],F=y[3],E=y[4],D=y[5],C=y[6],B=y[7],A=y[8];y[0]=I*R+F*Q+C*P;y[1]=H*R+E*Q+B*P;y[2]=G*R+D*Q+A*P;y[3]=I*O+F*N+C*M;y[4]=H*O+E*N+B*M;y[5]=G*O+D*N+A*M;y[6]=I*L+F*K+C*J;y[7]=H*L+E*K+B*J;y[8]=G*L+D*K+A*J},vec2_multiply:function(A,z){var y=[];y[0]=z[0]*A[0]+z[3]*A[1]+z[6];y[1]=z[1]*A[0]+z[4]*A[1]+z[7];return y},transpose:function(y){return[y[0],y[3],y[6],y[1],y[4],y[7],y[2],y[5],y[8]]}};function r(y){return this.clearStack(y)}var c=16;r.prototype.clearStack=function(y){this.m_stack=[];this.m_cache=[];this.c_stack=0;this.valid=0;this.result=null;for(var z=0;z<c;z++){this.m_stack[z]=this.getIdentity()}if(y!==undefined){this.m_stack[0]=y}else{this.setIdentity()}};r.prototype.setIdentity=function(){this.m_stack[this.c_stack]=this.getIdentity();if(this.valid===this.c_stack&&this.c_stack){this.valid--}};r.prototype.getIdentity=function(){return[1,0,0,0,1,0,0,0,1]};r.prototype.getResult=function(){if(!this.c_stack){return this.m_stack[0]}var y=k.identity;if(this.valid>this.c_stack-1){this.valid=this.c_stack-1}for(var z=this.valid;z<this.c_stack+1;z++){y=k.multiply(this.m_stack[z],y);this.m_cache[z]=y}this.valid=this.c_stack-1;this.result=this.m_cache[this.c_stack];return this.result};r.prototype.pushMatrix=function(){this.c_stack++;this.m_stack[this.c_stack]=this.getIdentity()};r.prototype.popMatrix=function(){if(this.c_stack===0){return}this.c_stack--};var q=r.prototype.getIdentity();r.prototype.translate=function(z,A){q[6]=z;q[7]=A;k.multiply(q,this.m_stack[this.c_stack])};var i=r.prototype.getIdentity();r.prototype.scale=function(z,A){i[0]=z;i[4]=A;k.multiply(i,this.m_stack[this.c_stack])};var a=r.prototype.getIdentity();r.prototype.rotate=function(y){var z,A;z=Math.sin(-y);A=Math.cos(-y);a[0]=A;a[3]=z;a[1]=-z;a[4]=A;k.multiply(a,this.m_stack[this.c_stack])};function w(E){var A=false;if(typeof window.ActiveXObject!="undefined"){try{var z=new ActiveXObject("ChromeTab.ChromeFrame");if(z){try{var B=document.createElement("canvas");var D=B.getContext("webgl")||B.getContext("experimental-webgl");A=(typeof(D)!=="undefined"&&D!==null)}catch(C){}}}catch(C){}}if(navigator.userAgent.indexOf("MSIE")<0||A){if(!A&&navigator.userAgent.indexOf("Opera")>=0){try{new o(document.createElement("canvas"))}catch(C){return}}new o(document.getElementById(E))}else{var y=document.createElement("object");y.onreadystatechange=function(){var F=document.getElementById(E);var G=document.createElement("object");G.onreadystatechange=function(){new o(G)};F.parentNode.replaceChild(G,F);G.id=E;G.width=F.width;G.height=F.height;G.type="application/x-webgl"};y.type="application/x-webgl"}}})();